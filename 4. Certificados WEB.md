- [**Infraestructura**](#infraestructura)
  - [Copiar información en contenedores](#copiar-información-en-contenedores)
- [**Certificados WEB**](#certificados-web)
  - [Solicitud del certificado](#solicitud-del-certificado)
  - [Firma del certificado](#firma-del-certificado)
  - [Configuración de WEB en la parte cliente](#configuración-de-web-en-la-parte-cliente)

# **Infraestructura**

Este guión de prácticas se basa en un servidor Apache sobre Ubuntu Server montado en una instancia de Docker.

Cada alumno tiene en la ruta /home/ciber/alumnos una carpeta con su nombre, que está mapeada al contenedor `httpd:latest` que tiene su nombre. 

Podemos gestionar la máquina desde consola o desde Portainer: 

- URL `https://<ipCiber>:9443`
- User: `ciber/ciberqueipo` 
- SSH `ciber@<ipCiber>`
- User: `ciber/ciber` 

## Copiar información en contenedores

Para copiar un fichero desde local a un contenedor:

```BASH
docker cp RUTA_LOCAL NOMBRE_CONTENEDOR:RUTA_DEL_CONTENEDOR
```

Para copiar desde contenedor a local 

```BASH
docker cp NOMBRE_CONTENEDOR:RUTA_DEL_CONTENEDOR RUTA_LOCAL
```

# **Certificados WEB**

El proceso de autenticar la conexión de un servidor WEB es similar a la emisión de un certificado digital para un usuario, pero el fichero de configuración cambia para ser usado como cifrado web.

Debemos disponer previamente de una clave privada de la organización, y de una CA que nos certifique la autenticidad del certificado. 

En este ejemplo vamos a emplear `DemoCA` como CA Raiz, y `user_privatekey.pem` como clave privada de la organización.

## Solicitud del certificado

Solicitud del certificado por parte del cliente.

```BASH
openssl req -new -key user_privatekey.pem -passin pass:1234 -subj "/C=ES/ST=Melilla/L=Melilla/O=HappyPig, S.L./OU=HappyPig-SI/CN=*.happypig.com/emailAddress=gerente@happypig.com" -out web_req.pem
```
Este certificado se envía a la CA Raíz con una petición de certificado con uso de cifrado WEB.

## Firma del certificado

La CA Raíz crea el fichero de configuración `config_web.cfg`

```BASH
[ my_extensions ]
basicConstraints = critical, CA:FALSE
extendedKeyUsage = critical, serverAuth
```

Se firma el fichero de configuración y se remite al cliente

```BASH
openssl x509 -CA ../demoCA/cacert.pem -CAkey ../demoCA/private/cakey.pem -passin pass:1234 -req -in ./web_req.pem -days 3650 -extfile ./configweb.txt -sha1 -CAserial ./demoCA/serial.slr -out userCertificate.pem
```

## Configuración de WEB en la parte cliente

--TO DO--

